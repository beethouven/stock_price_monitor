name: Daily Test Run  # âœ… Workflow çš„åç¨±ï¼Œå‡ºç¾åœ¨ GitHub Actions é é¢ä¸Š

# on:
#   schedule:  # â° ä½¿ç”¨æ’ç¨‹è§¸ç™¼ workflow
#     - cron: '0 2 * * *'  # ğŸŒ æ¯å¤© UTC æ™‚é–“ 02:00ï¼ˆå°ç£æ™‚é–“ä¸Šåˆ10:00ï¼‰åŸ·è¡Œ
#                          # æ ¼å¼ç‚ºï¼šåˆ† æ™‚ æ—¥ æœˆ æ˜ŸæœŸï¼ˆCronèªæ³•ï¼‰
#                          # å¯ç”¨å·¥å…·è½‰æ›ï¼šhttps://crontab.guru/

  # push è§¸ç™¼ï¼ˆå¯é¸ï¼‰
  # push:
  #   branches: [main]  # ç•¶ main åˆ†æ”¯æœ‰æ–° push å°±åŸ·è¡Œï¼ˆä½ å¯ä»¥å…ˆç”¨é€™æ®µæ¸¬è©¦ï¼‰

on:
  push:
    paths:
      - '.github/workflows/*.yaml'  # ğŸ› ï¸ åªè¦ workflows è³‡æ–™å¤¾ä¸‹çš„ YAML æª”æœ‰æ›´æ–°å°±è§¸ç™¼

jobs:
  run-test:  # ğŸ§ª Job åç¨±ï¼ˆä½ å¯ä»¥å‘½åç‚ºå…¶ä»–ç”¨é€”ï¼Œä¾‹å¦‚ run-stock-monitorï¼‰

    runs-on: ubuntu-latest  # ğŸ–¥ ä½¿ç”¨ GitHub æä¾›çš„ Ubuntu Runner ä¾†åŸ·è¡Œä»»å‹™

    steps:  # ğŸªœ æ¯å€‹æ­¥é©Ÿä¾åºåŸ·è¡Œ
      - name: Checkout repository
        uses: actions/checkout@v3  # ğŸ“¦ å–å¾—ç›®å‰ repo çš„ç¨‹å¼ç¢¼ï¼Œæº–å‚™åŸ·è¡Œ

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'  # ğŸ è¨­å®šä½¿ç”¨çš„ Python ç‰ˆæœ¬ç‚º 3.10

      - name: Install dependencies
        run: pip install -r requirements.txt  # ğŸ“¥ å®‰è£å¥—ä»¶ï¼ˆä½ åœ¨ requirements.txt è£¡å®šç¾©ï¼‰

      - name: Run test and generate report
        run: python run_test.py  # ğŸš€ åŸ·è¡Œä½ çš„ä¸»è…³æœ¬ï¼Œç”¢ç”Ÿå ±å‘Šèˆ‡ç´€éŒ„

      - name: Upload HTML report as artifact
        uses: actions/upload-artifact@v4
        with:
          name: test-report  # ğŸ“„ artifact åç¨±
          path: reports/latest_report.html  # ğŸ“ è¦ä¸Šå‚³çš„å ±å‘Šè·¯å¾‘ï¼ˆä½ å¯ä»¥ç”¨ timestamp ç‰ˆä¹Ÿè¡Œï¼‰

      - name: Send report via email
        uses: dawidd6/action-send-mail@v3  # ğŸ“§ ä½¿ç”¨ç¬¬ä¸‰æ–¹ mail action å¥—ä»¶å¯„å‡ºå ±å‘Š
        with:
          server_address: smtp.example.com  # âœ‰ï¸ SMTP ä¼ºæœå™¨åœ°å€ï¼ˆä¾‹å¦‚ Gmail å¯ç”¨ smtp.gmail.comï¼‰
          server_port: 587  # ğŸ” é€šå¸¸ä½¿ç”¨ 587 æˆ– 465ï¼ˆä¾æœå‹™è€Œå®šï¼‰
          username: ${{ secrets.EMAIL_USERNAME }}  # ğŸ‘¤ ç™»å…¥å¸³è™Ÿï¼ˆå¾ Secrets è®€å–ï¼‰
          password: ${{ secrets.EMAIL_PASSWORD }}  # ğŸ”‘ ç™»å…¥å¯†ç¢¼ï¼ˆå»ºè­°ç”¨ App Password æˆ– OAuth Tokenï¼‰
          subject: Daily Test Report  # ğŸ“Œ ä¿¡ä»¶ä¸»é¡Œ
          to: ${{ secrets.EMAIL_USERNAME }}  # ğŸ“¥ æ”¶ä»¶äººä¿¡ç®±
          from: ${{ secrets.EMAIL_USERNAME }}  # ğŸ“¤ å¯„ä»¶äººä¿¡ç®±ï¼ˆå¯èˆ‡ username ä¸€è‡´ï¼‰
          body: "è«‹åƒé–±ä»Šæ—¥æ¸¬è©¦å ±å‘Šï¼ŒHTML æª”æ¡ˆå·²é™„åŠ ã€‚"  # ğŸ“„ ä¿¡ä»¶å…§å®¹
          attachments: reports/latest_report.html  # ğŸ“ é™„åŠ å ±å‘Šæª”æ¡ˆ

      # ç›®å‰ä¸æ”¯æ´ LINE Notify çš„ç›´æ¥å¯„é€
      # å¦‚æœéœ€è¦ï¼Œå¯ä»¥ä½¿ç”¨ curl æˆ–å…¶ä»–å·¥å…·ä¾†å¯¦ç¾
      # - name: Send LINE Notify
      #   run: |
      #     curl -X POST https://notify-api.line.me/api/notify \
      #       -H "Authorization: Bearer ${{ secrets.LINE_NOTIFY_TOKEN }}" \
      #       -F "message=âœ… æ¸¬è©¦å®Œæˆï¼å ±å‘Šå·²å¯„å‡ºï¼Œè«‹æŸ¥çœ‹ä½ çš„ä¿¡ç®±ã€‚"  # ğŸ”” å‚³é€é€šçŸ¥è¨Šæ¯åˆ° LINE